# ---7212-st-
Код для ПЛК продольно-строгального станока 7212



Содержание:
1. Управление станком
2. Описание работы станка (с привязкой коду)
3. Код управления
4. Этапы модернизации
5. Список используемого оборудования


Управление станком
1.	Выбор режима работы:
•	Переключатель режима: Станок может работать в двух режимах:
•	Режим строгания:
•	Шпиндель не активен.
•	При движении стола против реза отключается электромагнитный соленоид прижима резца.
•	Режим шлифования:
•	Доступна функция управления шпинделем.
•	Перед запуском станины производится контроль включения шпинделя.
2.	Управление осью Z (перемещение портала):
•	Кнопка «+»: При нажатии на эту кнопку контроллер подает сигнал на включение электромагнитного пускателя для перемещения портала вверх.
•	Кнопка «-»: При нажатии на эту кнопку контроллер подает сигнал на включение электромагнитного пускателя для перемещения портала вниз.
•	Тормоз: При включении переключателя выбора оси Z тормоз ослабляется для свободного перемещения. При выключении переключателя тормоз зажимается для защиты от произвольных перемещений.
3.	Управление осью X (перемещение суппортов на портале):
•	Кнопка «+»: При нажатии на эту кнопку контроллер подает сигнал на включение электромагнитного пускателя для перемещения суппортов вправо.
•	Кнопка «-»: При нажатии на эту кнопку контроллер подает сигнал на включение электромагнитного пускателя для перемещения суппортов влево.
4.	Управление осью Y (подача станины):
•	Кнопка «+»: При нажатии на эту кнопку контроллер подает сигнал для управления частотным преобразователем двигателя, перемещающего станину вперед.
•	Кнопка «-»: При нажатии на эту кнопку контроллер подает сигнал для управления частотным преобразователем двигателя, перемещающего станину назад.
5.	Управление осью 1 (запуск станины):
•	Кнопка «+»: При нажатии на эту кнопку контроллер запускает станок в соответствующем направлении до концевого датчика разворота стола, затем меняет направление вращения до концевого датчика с противоположной стороны.
•	Кнопка «-»: Аналогично, при нажатии на эту кнопку контроллер запускает станок в противоположном направлении.
6.	Управление осью A1 (перемещение суппорта):
•	Кнопка «+»: При нажатии на эту кнопку контроллер производит грубое перемещение шпинделя на суппорте вверх.
•	Кнопка «-»: При нажатии на эту кнопку контроллер производит грубое перемещение шпинделя на суппорте вниз.
•	Энкодер (маховик): Позволяет производить точное перемещение шпинделя на суппорте.
Общие действия
•	Стоп станка: При нажатии на кнопку остановки (стоп) все действия останавливаются, и станок переходит в безопасное состояние.
•	Аварийная сигнализация: Если срабатывает одна из тревог (например, тревога частотника или серводрайвера), включается аварийный сигнал, и станок останавливается.




Описание работы станка (с привязкой коду)
(в коде не исправлен метод определения перегрузки двигателя при торможении оси Z)
Станок предназначен для выполнения операций строгания и шлифования с использованием различных осей перемещения. Управление осуществляется через пульт, который позволяет оператору выбирать режим работы, управлять перемещением осей и контролировать шпиндель.
1. Режимы работы
Станок может работать в двух режимах, которые переключаются с помощью логической переменной GVL.mode:
•	Режим строгания (mode = FALSE):
•	В этом режиме управление шпинделем отключено, что предотвращает его активацию во время строгания.
•	Электромагнитный соленоид прижима резца также отключен, что исключает его ненужное использование.
•	Режим шлифования (mode = TRUE):
•	В этом режиме доступна функция управления шпинделем. Оператор может включать и останавливать шпиндель в зависимости от необходимости.
•	Электромагнитный соленоид прижима резца не используется, что позволяет сосредоточиться на шлифовальных операциях.
2. Перемещение осей
Перемещение осей (X, Y, Z и A1) осуществляется с помощью электромагнитных пускателей, управляемых отдельными логическими переменными типа BOOL:
•	Ось X (перемещение суппортов):
•	GVL.out_x_r: Включает движение суппортов вправо.
•	GVL.out_x_l: Включает движение суппортов влево.
•	Ось Y (подача станины):
•	GVL.out_st_s1: Включает движение станины вперед.
•	GVL.out_st_s2: Включает движение станины назад.
•	Ось Z (перемещение портала):
•	GVL.out_z_r: Включает движение портала вверх.
•	GVL.out_z_l: Включает движение портала вниз.
•	Ось A1 (перемещение суппорта):
•	Управляется как с помощью кнопок «+» и «-», так и с помощью энкодера (маховика) для точной регулировки.
Оператор управляет перемещением с помощью кнопок, которые активируют соответствующие переменные. Код проверяет состояние кнопок и включает или отключает сигналы на перемещение.
3. Запуск станины
При нажатии на кнопки «+» и «-» для оси 1, контроллер запускает станок в соответствующем направлении до концевого датчика разворота станины. После достижения концевого датчика происходит смена направления вращения до концевого датчика с противоположной стороны.
4. Контроль работы тормоза оси Z
Контроль зажатия тормоза оси Z осуществляется через переменную GVL.brake_Ampere, которая управляет состоянием тормоза:
•	Выключение тормоза:
•	Контроллер отправляет сигнал на магнитный пускатель для вращения двигателя в сторону ослабления тормоза (GVL.out_z_l).
•	После выключения концевого датчика двигатель продолжает движение 3 секунды, что позволяет отвести тормоз на дополнительное расстояние от датчика.
•	Включение тормоза:
•	Контроллер отправляет сигнал на магнитный пускатель для вращения двигателя в сторону зажима тормоза (GVL.out_z_r).
•	Он контролирует ток двигателя датчиком, который отправляет сигнал ШИМ. Если включается концевой датчик зажима и ток повышается до определенного уровня (например, скважность сигнала больше 70%), происходит прекращение подачи сигнала зажима тормоза.
•	Если концевой датчик зажима не включается и ток повышается до того же уровня, происходит прекращение подачи сигнала зажима тормоза и отключение станка путем подачи сигнала аварии (GVL.out_alarm) до устранения неисправности.
5. Обработка сигналов от энкодера (маховика)
Перемещение оси A1 контролируется с помощью энкодеров. Код отслеживает изменения состояния сигналов EncoderA и EncoderB, что позволяет точно определять направление и количество шагов, которые необходимо выполнить:
•	Счетчик шагов (StepCount): Обновляется в зависимости от состояния энкодеров, что позволяет контролировать позицию оси.
•	Если EncoderA изменяется с LOW на HIGH, и EncoderB активен, счетчик увеличивается, иначе уменьшается. Аналогично происходит обработка для EncoderB.
6. Аварийные ситуации
В коде предусмотрены механизмы для обработки аварийных ситуаций. Если активируется сигнал тревоги от приводов (GVL.alarm_1, GVL.alarm_2, GVL.alarm_3) или происходит аварийная остановка (GVL.stop = FALSE), включается аварийный сигнал (GVL.out_alarm) и происходит полная остановка станка до устранения неисправности. Это обеспечивает безопасность оператора и предотвращает дальнейшие повреждения оборудования.
7. Управление шпинделем
В зависимости от режима работы (строгание или шлифование) контроллер управляет шпинделем:
•	Режим строгания: Шпиндель не активен, и его управление отключено. Это позволяет избежать ненужного вращения шпинделя во время строгания, когда он не требуется.
•	Режим шлифования:
•	Включение шпинделя: Если переменная GVL.spd_on активна, шпиндель включается, и переменная GVL.out_spd_run устанавливается в TRUE. Это позволяет шпинделю начать вращение для выполнения шлифовальных операций.
•	Остановка шпинделя: Если переменная GVL.spd_off активна, шпиндель останавливается, и переменная GVL.out_spd_run устанавливается в FALSE. Это необходимо для безопасного завершения работы и предотвращения повреждений.
8. Управление перемещением осей
Каждая ось (X, Y, Z и A1) управляется с помощью кнопок на пульте управления, которые активируют соответствующие переменные:
•	Ось X:
•	Кнопка «+» активирует переменную GVL.out_x_r, что приводит к перемещению суппортов вправо.
•	Кнопка «-» активирует переменную GVL.out_x_l, что приводит к перемещению суппортов влево.
•	Ось Y:
•	Кнопка «+» активирует управление частотным преобразователем для перемещения станины вперед.
•	Кнопка «-» активирует управление частотным преобразователем для перемещения станины назад.
•	Ось Z:
•	Кнопка «+» активирует переменную GVL.out_z_r, что приводит к перемещению портала вверх.
•	Кнопка «-» активирует переменную GVL.out_z_l, что приводит к перемещению портала вниз.
•	Ось A1:
•	Перемещение оси A1 осуществляется как с помощью кнопок «+» и «-», так и с помощью энкодера (маховика).
•	Кнопки «+» и «-» активируют соответствующие переменные для грубого перемещения, а энкодер позволяет точно регулировать позицию.
9. Обработка аварийных ситуаций
Код включает механизмы для обработки аварийных ситуаций:
•	Если активируется сигнал тревоги от приводов (GVL.alarm_1, GVL.alarm_2, GVL.alarm_3), или если происходит аварийная остановка (GVL.stop = FALSE), включается аварийный сигнал (GVL.out_alarm).
•	В случае активации аварийного сигнала происходит полная остановка станка, что предотвращает дальнейшие повреждения и обеспечивает безопасность оператора.
